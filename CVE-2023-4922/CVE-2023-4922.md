# CVE-2023-4922 - Unauth LFI in WPB-Show-Core Plugin

![image](https://github.com/mohamedabdelhady933/MY-CVEs-Analyzing/assets/73122852/1c3b6350-8c56-491c-8001-390253364b8e)



## Introduction

🔎 **CVE ID:** CVE-2023-4922

🔧 **Affected Product:** WPB-Show-Core Plugin <= 2.2

🔒 **Vendor:** WPB Show Core Projects

🐞 **Vulnerability:** Unauthenticated Local File Inclusion

📖 **Description:** Local file inclusion that allows attackers to uthorized access to local system files and the application source code.

📎 **Advisory Link:** [CVE-2023-4922](https://nvd.nist.gov/vuln/detail/CVE-2023-4922)


---

## Static Analysis

The WPB-show-core plugin is susceptible to a Local File Inclusion (LFI) vulnerability due to insufficient input validation when processing the ``path`` parameter via the GET request. The vulnerable code can be found within the plugin, where user-supplied data is used directly in a call to the readfile function, potentially allowing an attacker to traverse the file system and include arbitrary files.


In File ``download-file.php`` at  ``/wp-content/plugins/wpb-show-core/download-file.php`` endpoint 

![image](https://github.com/mohamedabdelhady933/MY-CVEs-Analyzing/assets/73122852/dc3f867e-0855-4e53-a48a-c9173e4e5188)

The snippt code shows that there is a ``path`` parameter required then doing URL decode.

The rest of the lines just set some headers , Then use ``readfile`` function that file and writes it to the output buffer.

``readfile`` function without any limitation or filteration , So it's vulnerable to local file inclusion (LFI).

## Attack Scenario 

An attacker can exploit this vulnerability by crafting a malicious ``path`` parameter containing a relative or absolute path to a sensitive file on the server. For example, an attacker could use a payload like ``?path=../../../etc/passwd`` to access the system's password file. If the server has improper file permissions, the attacker may successfully retrieve and download sensitive files.


## Mitigation

* Use filteration for the allowed files.
* Use random IDs for the needed files .
* Disable ``Allow_url_include`` because that cause SSRF too.
* Implementing Access Controls and Restrict Access.
